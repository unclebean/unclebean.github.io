<!DOCTYPE html>
<html itemtype="http://schema.org/Blog" lang="en"><head><title>Airflow beyond crontab</title><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><link href="/favicon.ico" rel="shortcut icon"><link href="/atom.xml" rel="alternate" title="Atom feed" type="application/atom+xml"><link href="/css/app.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Source%2BCode%2BPro%7CArvo%3A400%2C700%7CDroid%2BSerif%3A400%2C400italic%2C700" rel="stylesheet" type="text/css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/clojure.min.js" type="text/javascript"></script><script>hljs.initHighlightingOnLoad();</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-94017226-1', 'auto');
  ga('send', 'pageview');
</script><meta content="/images/airflow.png" property="og:image"><meta content="Airflow beyond crontab" property="og:title"><meta content="schedule workflow tool" property="og:description"></head><body><div class="header"><nav class="container" role="navigation"><div class="site"><a href="/"><img src="/images/ub_blog.svg"></a></div><ul><li><a href="/tags">Tags</a></li><li><a href="/about.html">About</a></li></ul></nav></div><div class="main"><div class="container post"><h1>Airflow beyond crontab</h1><div><h4><a href="#airflow-beyond-crontab" id="airflow-beyond-crontab"></a>Airflow beyond crontab</h4>
<blockquote>
<p>Do you want to have a tool which can aggregate news or data then email to you or your friends?</p>
<p>Are you working on data driven project, once get new data need to process step by step?</p>
<p>If you have same problem, airflow maybe a good candidate can solve the problem for you.</p>
</blockquote>
<p><strong>What's airflow</strong></p>
<p><a href="https://github.com/apache/airflow/blob/master/README.md">Apache Airflow (or simply Airflow) is a platform to programmatically author, schedule, and monitor workflows.</a> It has two main parts - webserver &amp; scheduler.</p>
<ul>
<li>webserver</li>
</ul>
<p>Webserver command will launch airflow dashboard to manange all schedule workflow via UI.</p>
<ul>
<li>scheduler</li>
</ul>
<p>This is a background process  uses to start scheduler and load all DAGs.</p>
<p><strong>Basic &amp; important concept of DAG and Task operator</strong></p>
<ul>
<li>DAG - directed acyclic graphs</li>
</ul>
<p>Use to define a workflow which running in airflow plantform, we can think it's a collection of tasks and running task by task with a crontab expression.</p>
<p>There is an example, means that I define a DAG will run every 30 mins, if DAG failed will delay 10 mins to trigger next job and only try once. <strong>Two things</strong> should be <strong>careful</strong>.</p>
<p>First - start date must be earlier than current date otherwise DAG will not start once you start airflow scheduler.</p>
<p>Second - Be careful <strong>timezone</strong>! Not only setting in DAG defination also need to make sure your system timezone is same as your DAG start date timezone, if it's different your DAG will run in the UTC time.</p>
<pre><code class="language-python">import airflow
import pendulum
from airflow import DAG
import datetime
from airflow.operators.python_operator import PythonOperator

utc_date = airflow.utils.dates.days_ago(1)
local_tz = pendulum.timezone(&quot;Asia/Singapore&quot;)


default_args = {
    &quot;owner&quot;: &quot;Sanji&quot;,
    &quot;depends_on_past&quot;: False,
    &quot;start_date&quot;: datetime.datetime(
        utc_date.year, utc_date.month, utc_date.day, tzinfo=local_tz
    ),
    &quot;retries&quot;: 1,
    &quot;retry_delay&quot;: datetime.timedelta(minutes=10),
}

example_dag = DAG(&quot;example&quot;, default_args=default_args, schedule_interval=&quot;*/30 * * * *&quot;)


</code></pre>
<ul>
<li>Task Operator</li>
</ul>
<p>Airflow provides a lot of different operators:</p>
<ul>
<li><a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/bash_operator/index.html#airflow.operators.bash_operator.BashOperator"><code>BashOperator</code></a> - executes a bash command</li>
<li><a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/python_operator/index.html#airflow.operators.python_operator.PythonOperator"><code>PythonOperator</code></a> - calls an arbitrary Python function</li>
<li><a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/email_operator/index.html#airflow.operators.email_operator.EmailOperator"><code>EmailOperator</code></a> - sends an email</li>
<li><a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/http_operator/index.html#airflow.operators.http_operator.SimpleHttpOperator"><code>SimpleHttpOperator</code></a> - sends an HTTP request</li>
<li><a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/mysql_operator/index.html#airflow.operators.mysql_operator.MySqlOperator"><code>MySqlOperator</code></a>, <a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/sqlite_operator/index.html#airflow.operators.sqlite_operator.SqliteOperator"><code>SqliteOperator</code></a>, <a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/postgres_operator/index.html#airflow.operators.postgres_operator.PostgresOperator"><code>PostgresOperator</code></a>, <a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/mssql_operator/index.html#airflow.operators.mssql_operator.MsSqlOperator"><code>MsSqlOperator</code></a>, <a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/oracle_operator/index.html#airflow.operators.oracle_operator.OracleOperator"><code>OracleOperator</code></a>, <a href="https://airflow.apache.org/docs/stable/_api/airflow/operators/jdbc_operator/index.html#airflow.operators.jdbc_operator.JdbcOperator"><code>JdbcOperator</code></a>, etc. - executes a SQL command</li>
</ul>
<p>Current I'm only using python operator for aggregating data and do further analysis. There is a very interesting question how to define the <em>task flow</em> ?</p>
<p>In Airflow we can use downstream/upsteam to define task flow and Airflow also provides bit shift operator.</p>
<pre><code class="language-python">task1 &gt;&gt; task2 &gt;&gt; task3 # that means run task1 first then task2 then task3
</code></pre>
<p><strong>Why Airflow</strong></p>
<ul>
<li>No outage</li>
</ul>
<p>Airflow is a python project whenever I change my DAG after that I no need to restart my scheduler service, the DAG will be reloaded automatically.</p>
<ul>
<li>Strategy</li>
</ul>
<p>For my scenario I need to run multiple strategies once data loaded, so I need clear data process flow. Airflow is really good for that case.</p>
<ul>
<li>Visualization monitoring task status</li>
</ul>
<p>I used to build dashboard for spring-boot scheduler project, it uses to manage &amp; monitor all scheduler jobs. I can't say it's not good, but as a good scheduler tool visualization &amp; mannually trigger job is very important. So Airflow is really realy good, see below screenshot, it's from my airflow server. It's very clear to monitor every task status. <img src="https://unclebean.github.io/images/airflow_status.png" alt="task status" /></p>
</div><aside class="comments"><div><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
            //this.page.url = 'http://unclebean.github.io/hugh/';
            this.page.identifier = '/airflow-beyond-crontab.html';
        };
        (function() { 
        var d = document, s = d.createElement('script');
        s.src = 'https://hj1984.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></noscript></div></aside></div></div><footer class="footer"><div class="container"><ul><li><a href="https://github.com/unclebean">github.com/unclebean</a></li></ul></div></footer><script>console.log("startup...");</script></body></html>