<!DOCTYPE html>
<html itemtype="http://schema.org/Blog" lang="en"><head><title>使用jupyter和Plotly创建可视化benchmark图表</title><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><link href="/favicon.ico" rel="shortcut icon"><link href="/atom.xml" rel="alternate" title="Atom feed" type="application/atom+xml"><link href="/css/app.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Source%2BCode%2BPro%7CArvo%3A400%2C700%7CDroid%2BSerif%3A400%2C400italic%2C700" rel="stylesheet" type="text/css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/clojure.min.js" type="text/javascript"></script><script>hljs.initHighlightingOnLoad();</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-94017226-1', 'auto');
  ga('send', 'pageview');
</script></head><body><div class="header"><nav class="container" role="navigation"><div class="site"><a href="/"><img src="/images/ub_blog.svg"></a></div><ul><li><a href="/tags">Tags</a></li><li><a href="/about.html">About</a></li></ul></nav></div><div class="main"><div class="container post"><h1>使用jupyter和Plotly创建可视化benchmark图表</h1><div><h4><a href="#使用jupyter和plotly创建性能分析图" id="使用jupyter和plotly创建性能分析图"></a>使用jupyter和Plotly创建性能分析图</h4>
<p><a href="https://unclebean.github.io/performance-chart_en.html">EN</a> <a href="https://unclebean.github.io/performance-chart.html">中文</a></p>
<p>编程到底是性能更重要还是可读、可维护更重要，我想不同语言的拥护者各有答案。但是基准测试对于所有语言的使用者来讲都是个有趣的话题，因为基准测试可以帮助我们写出即可读、可维护又相对高性能的代码。为什么是又呢，性能真的是一个只能相对的概念吧 ：）</p>
<p>什么是基准测试呢, 这是<a href="https://en.wikipedia.org/wiki/Benchmark_(computing)">wikipedia</a>的解释：</p>
<blockquote>
<p>In <a href="https://en.wikipedia.org/wiki/Computing">computing</a>, a <strong>benchmark</strong> is the act of running a <a href="https://en.wikipedia.org/wiki/Computer_program">computer program</a>, a set of programs, or other operations, in order to assess the relative <strong>performance</strong> of an object, normally by running a number of standard tests and trials against it.[<a href="https://en.wikipedia.org/wiki/Benchmark_(computing)#cite_note-1">1]</a> The term 'benchmark' is also mostly utilized for the purposes of elaborately designed benchmarking programs themselves.</p>
</blockquote>
<p>其实不管是专注于function的benchmark，还是http server的benchmark都是希望借助基准测试找到更优的实现方式。我用过的基准测试工具不多，之后打算把每一个工具写一个文章记录一下。这里列举一些，也算是一个推荐：</p>
<ul>
<li><a href="http://openjdk.java.net/projects/code-tools/jmh/">jmh</a> java的官方benchmark工具，在有了jshell之后这个工具使用起来应该会更方便一些了，甚至不需要继承到项目里面。</li>
<li><a href="https://benchmarkjs.com/">Benchmark.js</a> javascript/nodejs的benchmark工具。</li>
<li><a href="https://github.com/angular/angular/tree/master/packages/benchpress">benchpress</a> angular官方的e2e performance工具，这个是我非常喜欢的前端performance工具了，其实不只是可以用来测试angular app，因为它是基于h5 performance API的工具，所以可以用在任何前端项目上。</li>
<li><a href="https://github.com/brendangregg/perf-tools">perf-tools</a> linux下的benchmark工具，基本可以用来对任何语言进行基准测试。</li>
<li><a href="https://httpd.apache.org/docs/2.4/programs/ab.html">ab</a> apache http server benchmark tool。</li>
<li><a href="https://github.com/rakyll/hey">hey</a> go语言实现的http server benchmark tool。</li>
</ul>
<p>这些工具，除了<strong>benchpress</strong>其他都是命令行工具，都没有办法生成可视化图表，所以我一直想找一个能把benchmark的分析数据可视化的好办法。于是乎我就找到了<a href="https://plot.ly/javascript/">Plotly.js</a>，没错这是一个前端库，但是他提供了众多其他编程语言的集成API，具体可以看<a href="https://plot.ly/api/">这里</a>。我最喜欢的python的API，可以非常方便的和jupyter一起使用。</p>
<p><a href="https://plot.ly/python/getting-started/">安装步骤</a>: (假设已经安装了<a href="http://jupyter.org">jupyter</a>)</p>
<pre><code class="language-shell">$ pip install plotly 
</code></pre>
<p>之后需要在Plotly创建一个<a href="https://plot.ly/feed/">free account</a>,免费账号可以保存25张图表。其实只要定期删除不用的chart，基本已经够用了。</p>
<p>注册之后需要在jupyter里面设置你的account和api_key(在<a href="https://plot.ly/settings/api">settings</a>里面可以看到)</p>
<pre><code class="language-python">import plotly
plotly.tools.set_credentials_file(username='用户名', api_key='api_key')
</code></pre>
<p>下面就来创建一个benchmark图表试一下，我找了一个reacjs benchmark项目，这个项目并不是我的，算是借花献佛。</p>
<p><a href="https://github.com/aickin/react-16-ssr-perf/tree/new-prod-mode-15">react-16-ssr-perf</a>这个项目的作者用的chart好像和我找到的并不一样，但是没关系大家想要达到的目的是一样的。</p>
<pre><code class="language-python">import plotly.plotly as py
import plotly.graph_objs as go
from plotly.graph_objs import *
react15Raw = go.Bar(
    x=['NodeJS4.83', 'NodeJS6.11', 'NodeJS8.2', 'NodeJS8.3'],
    y=[241, 200, 152, 140],
    name='React 15.6.1(raw)'
)
react15Compiled = go.Bar(
    x=['NodeJS4.83', 'NodeJS6.11', 'NodeJS8.2', 'NodeJS8.3'],
    y=[125, 82, 55, 49],
    name='React 15.6.1(compiled)'
)
react16 = go.Bar(
    x=['NodeJS4.83', 'NodeJS6.11', 'NodeJS8.2', 'NodeJS8.3'],
    y=[60, 28, 17, 15],
    name='React 16'
)
data = [react15Raw, react15Compiled, react16]
layout = go.Layout(
    barmode='group'
)
fig = go.Figure(data=data, layout=layout)
py.iplot(fig, filename='grouped-bar')
</code></pre>
<p><img src="https://unclebean.github.io/images/newplot.png" alt="plot" /><a href="https://unclebean.github.io/">https://unclebean.github.io/</a></p>
</div><aside class="comments"><div><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
            //this.page.url = 'http://unclebean.github.io/hugh/';
            this.page.identifier = '/performance-chart.html';
        };
        (function() { 
        var d = document, s = d.createElement('script');
        s.src = 'https://hj1984.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></noscript></div></aside></div></div><footer class="footer"><div class="container"><ul><li><a href="https://github.com/unclebean">github.com/unclebean</a></li></ul></div></footer><script>console.log("startup...");</script></body></html>